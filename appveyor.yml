-
  branches:
    except:
      - release
      - /v\d\.\d\.\d/

  skip_branch_with_pr: true
  skip_tags: true

  os: Visual Studio 2013

  configuration: development

  platform:
    - x64

  version: "{build}"

  build: off
  shallow_clone: true

  clone_folder: c:\node-raw-socket

  init:
    - ps: set-location -path c:\node-raw-socket

  cache:
    - '%userprofile%\.node-gyp'
    - '%AppData%\npm-cache'

  environment:
    matrix:
      # - nodejs_version: 4
      - nodejs_version: 6
      # - nodejs_version: 7

  install:
    - ps: Install-Product node $env:nodejs_version $env:platform
    - node --version
    - npm --version
    - npm install --build-from-source --msvs_version=2013
    - 7z -ttar a dummy c:\node-raw-socket\build\* -so | 7z -si -tgzip a win32-x64-node-v48_binding.tar.gz
 
  artifacts:
    - path: win32-x64-node-v48_binding.tar.gz

  deploy:
    - provider: GitHub
      description: Great release for us
      # artifact: /node-raw-socket/
      draft: true
      prerelease: false
      force_update: true
      auth_token:
        secure: txo0j3thuQZP+B3m2XOTbRAwpWj7rVp2+mTIVmV+8uBoYcyNhmRfGc4WrviKVRuh
      on:
        branch: prebuilt                # release from master branch only
        appveyor_repo_tag: false       # deploy on tag push only
